<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Saf.GPT | Ultra Smooth Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #010204;
            --primary: #2563eb;
            --neon: #00f3ff;
            --card-bg: rgba(8, 12, 24, 0.95);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Tajawal', sans-serif;
            margin: 0; padding: 0;
            user-select: none;
        }

        body {
            background-color: var(--bg);
            color: white;
            height: 100dvh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Transitions --- */
        .page {
            position: absolute;
            inset: 0;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-out, transform 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            transform: scale(1.02);
            display: flex;
            flex-direction: column;
            padding-bottom: 85px;
            background: var(--bg);
        }

        .page.active {
            opacity: 1;
            pointer-events: all;
            transform: scale(1);
            z-index: 10;
        }

        /* --- Page 1: Chat UI --- */
        .chat-header {
            background: rgba(1, 2, 4, 0.9);
            backdrop-filter: blur(25px);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 20;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            scroll-behavior: smooth;
        }

        .msg {
            max-width: 85%;
            padding: 14px 18px;
            border-radius: 22px;
            font-size: 14px;
            line-height: 1.6;
            animation: msgPop 0.2s ease-out forwards;
            position: relative;
            will-change: transform, opacity;
        }

        .msg-user {
            align-self: flex-start;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-bottom-right-radius: 4px;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.2);
        }

        .msg-ai {
            align-self: flex-end;
            background: #1e293b;
            border: 1px solid rgba(255,255,255,0.08);
            border-bottom-left-radius: 4px;
        }

        .ai-label {
            display: block;
            font-size: 10px;
            font-weight: 900;
            color: var(--neon);
            margin-bottom: 4px;
            letter-spacing: 0.5px;
        }

        @keyframes msgPop { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        .input-dock {
            padding: 15px;
            background: rgba(1, 2, 4, 0.95);
            border-top: 1px solid rgba(255,255,255,0.05);
            display: flex; gap: 10px;
        }

        /* --- Page 2: Ultra Nexus UI --- */
        #nexus-canvas {
            position: absolute;
            inset: 0;
            z-index: 0;
            touch-action: none;
        }

        .nexus-header {
            position: absolute;
            top: 30px; width: 100%;
            text-align: center;
            pointer-events: none;
            z-index: 10;
        }

        .info-bubble {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 88%;
            max-width: 360px;
            background: var(--card-bg);
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: 24px;
            padding: 28px;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s cubic-bezier(0.19, 1, 0.22, 1);
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            z-index: 100;
            backdrop-filter: blur(20px);
        }

        .info-bubble.active {
            opacity: 1;
            pointer-events: all;
            transform: translate(-50%, -50%) scale(1);
        }

        /* --- Optimized Navigation --- */
        .nav-dock {
            position: fixed;
            bottom: 25px; left: 50%;
            transform: translateX(-50%);
            background: rgba(10, 15, 25, 0.85);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 100px;
            padding: 6px;
            display: flex;
            gap: 4px;
            z-index: 1000;
        }

        .nav-btn {
            padding: 12px 24px;
            border-radius: 100px;
            font-size: 13px;
            font-weight: 700;
            color: #94a3b8;
            transition: all 0.2s;
            display: flex; align-items: center; gap: 8px;
        }

        .nav-btn.active {
            background: white;
            color: black;
        }

        .glow { text-shadow: 0 0 20px var(--neon); }
    </style>
</head>
<body>

    <!-- Page 1: Saf.GPT -->
    <section id="chat-page" class="page active">
        <header class="chat-header">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center font-black text-xs shadow-lg">Saf</div>
                <div>
                    <h1 class="text-sm font-black">Saf.GPT</h1>
                    <span class="text-[9px] text-green-400 font-bold uppercase tracking-tighter">â— Ù†Ø¸Ø§Ù… Ù†Ø´Ø·</span>
                </div>
            </div>
            <button onclick="clearChat()" class="text-[10px] font-bold text-red-400 bg-red-500/10 px-4 py-2 rounded-xl border border-red-500/20 active:opacity-50">
                Ù…Ø­Ùˆ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ğŸ—‘ï¸
            </button>
        </header>

        <div id="chat-box" class="chat-area">
            <div class="msg msg-ai">
                <span class="ai-label">Saf.GPT</span>
                Ø¬Ø§Ù‡Ø² Ù„Ø®Ø¯Ù…ØªÙƒ ÙŠØ§ ØµÙÙˆØ§Ù†. Ø§Ø³Ø£Ù„ Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡ØŒ Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø©.
            </div>
        </div>

        <div class="input-dock">
            <input type="text" id="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." class="flex-1 bg-white/5 border border-white/10 rounded-2xl px-5 text-sm text-white focus:outline-none focus:border-blue-500 transition-all">
            <button onclick="sendMsg()" class="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center active:scale-95 transition-transform">
                <svg class="w-6 h-6 rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2.5" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
            </button>
        </div>
    </section>

    <!-- Page 2: Ultra Nexus -->
    <section id="nexus-page" class="page" style="padding:0; background:#000;">
        <canvas id="nexus-canvas"></canvas>
        <div class="nexus-header">
            <h2 class="text-2xl font-black text-white glow">Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø²Ù…Ù†ÙŠØ© 5.0</h2>
            <p class="text-[10px] text-cyan-400 uppercase tracking-[0.2em] mt-1">Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙØ§Ø¦Ù‚Ø© Ø§Ù„Ø³Ø±Ø¹Ø©</p>
        </div>

        <div id="bubble" class="info-bubble">
            <h3 id="b-title" class="text-3xl font-black text-cyan-400 mb-3 tracking-tighter"></h3>
            <p id="b-desc" class="text-md text-white font-medium leading-relaxed"></p>
            <button onclick="closeBubble()" class="mt-6 w-full py-3 bg-white/5 rounded-2xl text-xs font-bold text-white/40 active:bg-white/10">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </section>

    <!-- Nav -->
    <nav class="nav-dock">
        <button onclick="nav('chat')" class="nav-btn active" id="btn-chat">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</button>
        <button onclick="nav('nexus')" class="nav-btn" id="btn-nexus">Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</button>
    </nav>

    <script>
        const apiKey = ""; 

        /* --- Optimized Chat --- */
        const chatBox = document.getElementById('chat-box');
        const chatInput = document.getElementById('chat-input');

        async function sendMsg() {
            const val = chatInput.value.trim();
            if(!val) return;
            appendMsg(val, 'user');
            chatInput.value = '';
            const tid = appendMsg('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...', 'ai', true);
            
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: val }] }],
                        systemInstruction: { parts: [{ text: "Ø§Ø³Ù…Ùƒ Saf.GPT. Ø§Ø¨Ø¯Ø£ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø¨Ù€ [Saf.GPT]: . ÙƒÙ† Ø°ÙƒÙŠØ§Ù‹ ÙˆØ³Ø±ÙŠØ¹Ø§Ù‹." }] }
                    })
                });
                const data = await res.json();
                document.getElementById(tid).remove();
                appendMsg(data.candidates?.[0]?.content?.parts?.[0]?.text || "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…", 'ai');
            } catch(e) {
                document.getElementById(tid).remove();
                appendMsg("[Saf.GPT]: Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©.", 'ai');
            }
        }

        function appendMsg(txt, type, loading=false) {
            const id = 'm'+Date.now();
            const d = document.createElement('div');
            d.id = id;
            d.className = `msg msg-${type}`;
            if(type === 'ai') d.innerHTML = `<span class="ai-label">Saf.GPT</span>${txt}`;
            else d.innerText = txt;
            chatBox.appendChild(d);
            chatBox.scrollTop = chatBox.scrollHeight;
            return id;
        }

        function clearChat() {
            chatBox.innerHTML = '';
            appendMsg("ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø© ÙŠØ§ ØµÙÙˆØ§Ù†.", 'ai');
        }

        /* --- Ultra-Smooth Nexus Engine --- */
        const canvas = document.getElementById('nexus-canvas');
        const ctx = canvas.getContext('2d', { alpha: false }); // Optimization: no alpha channel for background
        let width, height, nodes = [], animationId;

        const DATA = [
            {t:"12 Ù…Ø§Ø±Ø³ 1947", d:"Ù…Ø¨Ø¯Ø£ ØªØ±ÙˆÙ…Ø§Ù†: Ø¯Ø¹Ù… ØªØ±ÙƒÙŠØ§ ÙˆØ§Ù„ÙŠÙˆÙ†Ø§Ù† Ù„Ù…ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø²Ø­Ù Ø§Ù„Ø´ÙŠÙˆØ¹ÙŠ."},
            {t:"05 Ø¬ÙˆØ§Ù† 1947", d:"Ù…Ø´Ø±ÙˆØ¹ Ù…Ø§Ø±Ø´Ø§Ù„: Ø®Ø·Ø© Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© Ø£Ù…Ø±ÙŠÙƒÙŠØ© Ù„Ø±Ø¨Ø· Ø£ÙˆØ±ÙˆØ¨Ø§ Ø¨Ø§Ù„Ø±Ø£Ø³Ù…Ø§Ù„ÙŠØ©."},
            {t:"22 Ø³Ø¨Øª 1947", d:"Ù…Ø¨Ø¯Ø£ Ø¬Ø¯Ø§Ù†ÙˆÙ: Ø§Ù„Ø±Ø¯ Ø§Ù„Ø³ÙˆÙÙŠØ§ØªÙŠ Ø¨ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¹Ø§Ù„Ù… Ù„Ù…Ø¹Ø³ÙƒØ±ÙŠÙ†."},
            {t:"05 Ø£ÙƒØª 1947", d:"Ù…ÙƒØªØ¨ Ø§Ù„ÙƒÙˆÙ…ÙŠÙ†ÙÙˆØ±Ù…: Ù…ÙƒØªØ¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø´ÙŠÙˆØ¹ÙŠ Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø­Ø²Ø§Ø¨."},
            {t:"25 Ø¬Ø§Ù† 1949", d:"Ù…Ù†Ø¸Ù…Ø© Ø§Ù„ÙƒÙˆÙ…ÙŠÙƒÙˆÙ†: Ù…Ø¬Ù„Ø³ Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ Ù„Ù„Ù…Ø¹Ø³ÙƒØ± Ø§Ù„Ø´Ø±Ù‚ÙŠ."},
            {t:"04 Ø£ÙØ±ÙŠÙ„ 1949", d:"Ø­Ù„Ù Ø§Ù„Ù†Ø§ØªÙˆ (NATO): Ø§Ù„ØªÙƒØªÙ„ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ Ø§Ù„ØºØ±Ø¨ÙŠ."},
            {t:"14 Ù…Ø§ÙŠ 1955", d:"Ø­Ù„Ù ÙˆØ§Ø±Ø³Ùˆ: Ø§Ù„ØªÙƒØªÙ„ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ Ø§Ù„Ø´Ø±Ù‚ÙŠ Ø±Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø­Ù„Ù Ø§Ù„Ø£Ø·Ù„Ø³ÙŠ."},
            {t:"05 Ø¬Ø§Ù† 1957", d:"Ù…Ø´Ø±ÙˆØ¹ Ø£ÙŠØ²Ù†Ù‡Ø§ÙˆØ±: Ù…Ù„Ø¡ Ø§Ù„ÙØ±Ø§Øº ÙÙŠ Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø· Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø¯ÙˆØ§Ù† Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ."},
            {t:"1953", d:"ÙˆÙØ§Ø© Ø¬ÙˆØ²ÙŠÙ Ø³ØªØ§Ù„ÙŠÙ†: Ø¨Ø¯Ø§ÙŠØ© Ù…Ø±Ø­Ù„Ø© Ø°ÙˆØ¨Ø§Ù† Ø§Ù„Ø¬Ù„ÙŠØ¯."},
            {t:"1956", d:"ØªØ£Ù…ÙŠÙ… Ù‚Ù†Ø§Ø© Ø§Ù„Ø³ÙˆÙŠØ³ ÙˆØ§Ù„Ø¹Ø¯ÙˆØ§Ù† Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø¹Ù„Ù‰ Ù…ØµØ±."},
            {t:"13 Ø£ÙˆØª 1961", d:"Ø¨Ù†Ø§Ø¡ Ø¬Ø¯Ø§Ø± Ø¨Ø±Ù„ÙŠÙ†: Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…Ø§Ø¯ÙŠ Ù„Ù„Ø­Ø±Ø¨ Ø§Ù„Ø¨Ø§Ø±Ø¯Ø©."},
            {t:"Ø³Ø¨ØªÙ…Ø¨Ø± 1961", d:"ØªØ£Ø³ÙŠØ³ Ø­Ø±ÙƒØ© Ø¹Ø¯Ù… Ø§Ù„Ø§Ù†Ø­ÙŠØ§Ø² (Ù…Ø¤ØªÙ…Ø± Ø¨Ù„ØºØ±Ø§Ø¯)."},
            {t:"20 Ø¬ÙˆØ§Ù† 1963", d:"Ø§Ù„Ø®Ø· Ø§Ù„Ù‡Ø§ØªÙÙŠ Ø§Ù„Ø£Ø­Ù…Ø±: Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù„Ø­Ø±ÙˆØ¨ Ø§Ù„Ù†ÙˆÙˆÙŠØ© Ø§Ù„Ù…ÙØ§Ø¬Ø¦Ø©."},
            {t:"1972", d:"Ø§ØªÙØ§Ù‚ÙŠØ© Ø³Ø§Ù„Øª 1: Ø§Ù„Ø­Ø¯ Ù…Ù† Ø§Ù„Ø£Ø³Ù„Ø­Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©."},
            {t:"1979", d:"Ø³Ø§Ù„Øª 2: Ø§Ø³ØªÙ…Ø±Ø§Ø± Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ØªØ³Ù„Ø­ Ø§Ù„Ù…Ù‚Ù†Ù†."},
            {t:"09 Ù†ÙˆÙ 1989", d:"ØªØ­Ø·Ù… Ø¬Ø¯Ø§Ø± Ø¨Ø±Ù„ÙŠÙ†."},
            {t:"Ø¯ÙŠØ³Ù…Ø¨Ø± 1989", d:"Ù‚Ù…Ø© Ù…Ø§Ù„Ø·Ø§: Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¹Ù† Ù‚Ø±Ø¨ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµØ±Ø§Ø¹."},
            {t:"03 Ø£ÙƒØª 1990", d:"ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØªÙŠÙ† ÙˆØ³Ù‚ÙˆØ· Ø§Ù„Ø³ØªØ§Ø± Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ."},
            {t:"Ù†ÙˆÙÙ…Ø¨Ø± 1990", d:"Ù…Ø¤ØªÙ…Ø± Ø¨Ø§Ø±ÙŠØ³: Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ù„Ù„Ø­Ø±Ø¨ Ø§Ù„Ø¨Ø§Ø±Ø¯Ø©."},
            {t:"Ø¬ÙˆÙŠÙ„ÙŠØ© 1991", d:"Ø­Ù„ Ø­Ù„Ù ÙˆØ§Ø±Ø³Ùˆ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹."},
            {t:"Ø¯ÙŠØ³Ù…Ø¨Ø± 1991", d:"ØªÙÙƒÙƒ Ø§Ù„Ø§ØªØ­Ø§Ø¯ Ø§Ù„Ø³ÙˆÙÙŠØ§ØªÙŠ ÙˆØ¸Ù‡ÙˆØ± Ø±ÙˆØ³ÙŠØ§."},
            {t:"1945", d:"ØªØ£Ø³ÙŠØ³ Ù…Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ù…Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø©."},
            {t:"1950-1953", d:"Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„ÙƒÙˆØ±ÙŠØ©: Ø£Ø­Ø¯ Ø£Ø®Ø·Ø± Ø§Ù„Ø£Ø²Ù…Ø§Øª Ø§Ù„Ù…Ø³Ù„Ø­Ø©."},
            {t:"1962", d:"Ø£Ø²Ù…Ø© Ø§Ù„ØµÙˆØ§Ø±ÙŠØ® ÙÙŠ ÙƒÙˆØ¨Ø§."},
            {t:"1954", d:"Ø­Ù„Ù Ø¬Ù†ÙˆØ¨ Ø´Ø±Ù‚ Ø¢Ø³ÙŠØ§ (SEATO)."},
            {t:"1955", d:"Ø­Ù„Ù Ø¨ØºØ¯Ø§Ø¯ (Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø§Ù„Ø­Ù„Ù Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ)."},
            {t:"1955", d:"Ù…Ø¤ØªÙ…Ø± Ø¨Ø§Ù†Ø¯ÙˆÙ†Øº: Ø¸Ù‡ÙˆØ± ÙƒØªÙ„Ø© Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø«Ø§Ù„Ø«."},
            {t:"1956", d:"Ø­Ù„ Ù…ÙƒØªØ¨ Ø§Ù„ÙƒÙˆÙ…ÙŠÙ†ÙÙˆØ±Ù…."},
            {t:"1973", d:"Ù…Ø¤ØªÙ…Ø± Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ù„Ø¹Ø¯Ù… Ø§Ù„Ø§Ù†Ø­ÙŠØ§Ø² (Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯)."},
            {t:"1948", d:"Ø£Ø²Ù…Ø© Ø¨Ø±Ù„ÙŠÙ† Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø§Ù„Ø­ØµØ§Ø±)."},
            {t:"1975", d:"Ø§ØªÙØ§Ù‚ÙŠØ© Ù‡Ù„Ø³Ù†ÙƒÙŠ Ù„Ù„Ø£Ù…Ù† ÙˆØ§Ù„ØªØ¹Ø§ÙˆÙ† ÙÙŠ Ø£ÙˆØ±ÙˆØ¨Ø§."},
            {t:"1985", d:"ÙˆØµÙˆÙ„ ØºÙˆØ±Ø¨Ø§ØªØ´ÙˆÙ Ù„Ù„Ø­ÙƒÙ… (Ø§Ù„Ø¨Ø±ÙŠØ³ØªØ±ÙˆÙŠÙƒØ§)." }
        ];

        class Node {
            constructor(d) {
                this.d = d;
                this.reset();
            }
            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = (Math.random() - 0.5) * 0.8;
                this.vy = (Math.random() - 0.5) * 0.8;
                this.r = this.d.t ? 4 : 2;
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                if(this.x < 0 || this.x > width) this.vx *= -1;
                if(this.y < 0 || this.y > height) this.vy *= -1;
            }
        }

        function initNexus() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            nodes = DATA.map(d => new Node(d));
            for(let i=0; i<10; i++) nodes.push(new Node({t:"", d:""}));
        }

        function draw() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);

            ctx.lineWidth = 0.8;
            for(let i=0; i<nodes.length; i++) {
                const n1 = nodes[i];
                n1.update();
                
                for(let j=i+1; j<nodes.length; j++) {
                    const n2 = nodes[j];
                    const dx = n1.x - n2.x;
                    const dy = n1.y - n2.y;
                    const dist = dx*dx + dy*dy; // Optimization: avoiding sqrt for distance check
                    if(dist < 14400) { // 120^2
                        ctx.strokeStyle = `rgba(0, 243, 255, ${1 - Math.sqrt(dist)/120})`;
                        ctx.beginPath();
                        ctx.moveTo(n1.x, n1.y);
                        ctx.lineTo(n2.x, n2.y);
                        ctx.stroke();
                    }
                }
                
                ctx.fillStyle = n1.d.t ? '#00f3ff' : '#1e293b';
                ctx.beginPath();
                ctx.arc(n1.x, n1.y, n1.r, 0, 7);
                ctx.fill();
            }
            animationId = requestAnimationFrame(draw);
        }

        canvas.addEventListener('pointerdown', e => {
            const x = e.clientX, y = e.clientY;
            let found = false;
            nodes.forEach(n => {
                if(n.d.t && Math.hypot(n.x - x, n.y - y) < 40) {
                    showB(n.d);
                    found = true;
                }
            });
            if(!found) closeBubble();
        });

        function showB(data) {
            document.getElementById('b-title').innerText = data.t;
            document.getElementById('b-desc').innerText = data.d;
            document.getElementById('bubble').classList.add('active');
        }

        function closeBubble() {
            document.getElementById('bubble').classList.remove('active');
        }

        function nav(p) {
            document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(`${p}-page`).classList.add('active');
            document.getElementById(`btn-${p}`).classList.add('active');
            if(p === 'nexus') {
                initNexus();
                if(!animationId) draw();
            } else {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }

        window.addEventListener('resize', initNexus);
        chatInput.addEventListener('keypress', e => e.key === 'Enter' && sendMsg());
    </script>
</body>
</html>


